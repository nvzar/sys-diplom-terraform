# –î–∏–ø–ª–æ–º–Ω–∞—è —Ä–∞–±–æ—Ç–∞: –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤ Yandex Cloud

## –û–ø–∏—Å–∞–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –≤–µ–±-—Å–∞–π—Ç–∞ –≤ Yandex Cloud —Å:
- Load Balancing
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º (Zabbix)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º (Elasticsearch + Kibana)
- –†–µ–∑–µ—Ä–≤–Ω—ã–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ–º (Snapshot Schedule)

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤: Terraform + Ansible

### –î–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å

–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–µ—Ç—Å—è –≤ **–¥–≤–∞ —ç—Ç–∞–ø–∞** —Å –ø–æ–ª–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–µ–π:

#### –≠—Ç–∞–ø 1: Terraform —Å–æ–∑–¥–∞–µ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ Yandex Cloud

```bash
cd terraform/
terraform init
terraform apply -auto-approve
```

**Terraform —Å–æ–∑–¥–∞–µ—Ç:**
- VPC Network —Å –ø—É–±–ª–∏—á–Ω—ã–º–∏ –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–º–∏ –ø–æ–¥—Å–µ—Ç—è–º–∏
- 6 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω (Bastion, Web-1, Web-2, Zabbix, Elasticsearch, Kibana)
- Application Load Balancer –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞
- Security Groups –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- Snapshot Schedule –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è

#### –≠—Ç–∞–ø 2: Ansible –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –í–ú, Terraform **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –∑–∞–ø—É—Å–∫–∞–µ—Ç Ansible:

**–§–∞–∑–∞ 1:** Common Configuration (–≤—Å–µ —Å–µ—Ä–≤–µ—Ä—ã)
**–§–∞–∑–∞ 2:** Web Servers (Nginx + Zabbix Agent)
**–§–∞–∑–∞ 3:** Monitoring (Zabbix Server)
**–§–∞–∑–∞ 4:** Logging (Elasticsearch + Kibana)
**–§–∞–∑–∞ 5:** Integration (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Zabbix)

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. `terraform apply` —Å–æ–∑–¥–∞–µ—Ç –≤—Å–µ –í–ú –≤ –æ–±–ª–∞–∫–µ
2. Terraform –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `ansible/inventory/hosts.yml`
3. Terraform –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `ansible/ssh.config`
4. Terraform –∑–∞–ø—É—Å–∫–∞–µ—Ç `ansible-playbook` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
5. Ansible –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç 5 —Ñ–∞–∑
6. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

```bash
terraform output
cd ../ansible
ansible all -i inventory/hosts.yml -m ping
ssh -F ssh.config web-1
curl http://localhost
```

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

- **[server-provisioning.md](server-provisioning.md)** - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **[ansible-roles.md](ansible-roles.md)** - –†–æ–ª–∏
- **[quick-start.md](quick-start.md)** - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- **[implementation-guide.md](implementation-guide.md)** - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

### –†–µ—à–µ–Ω–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è—é—â–µ–≥–æ

**–ó–∞–º–µ—á–∞–Ω–∏–µ:** "–ù–µ –Ω–∞—à–µ–ª –∫–∞–∫ –≤—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞ (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è)"

**–†–µ—à–µ–Ω–∏–µ:**
1. ‚úÖ provisioning.tf - –∑–∞–ø—É—Å–∫–∞–µ—Ç Ansible
2. ‚úÖ playbooks/site.yml - 5 —Ñ–∞–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
3. ‚úÖ roles/ - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤
4. ‚úÖ server-provisioning.md - –ø–æ–ª–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
5. ‚úÖ quick-start.md - –ø–æ—à–∞–≥–æ–≤—ã–π —Å—Ç–∞—Ä—Ç

---

## üìä –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞

### Terraform Output
![Terraform Output](screenshots/01-terraform-output.png)

### –í–ú –≤ —Å—Ç–∞—Ç—É—Å–µ RUNNING
![VMs Running](screenshots/02-vms-running.png)

### Zabbix Dashboard
![Zabbix Dashboard](screenshots/03-zabbix-dashboard.png)

### Kibana Dashboard
![Kibana Dashboard](screenshots/04-kibana-dashboard.png)

### Security Groups
![Security Groups](screenshots/05-security-groups.png)

### Snapshot Schedules
![Snapshot Schedules](screenshots/06-snapshot-schedules.png)

### GitHub Repository
![GitHub Repo](screenshots/07-github-repo.png)

### Bastion SSH Access
![Bastion SSH](screenshots/08-bastion-ssh.png)

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°–µ—Ç—å
- **VPC Network**: diplom-network
- **–ü—É–±–ª–∏—á–Ω–∞—è –ø–æ–¥—Å–µ—Ç—å**: public-subnet
- **–ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –ø–æ–¥—Å–µ—Ç–∏**: private-subnet-a, private-subnet-b
- **NAT Gateway**: –¥–ª—è –∏—Å—Ö–æ–¥—è—â–µ–≥–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –∏–∑ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —Å–µ—Ç–µ–π
- **Bastion Host**: –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–∏–≤–∞—Ç–Ω—ã–º –í–ú —á–µ—Ä–µ–∑ SSH

### –í–µ–±-—Å–µ—Ä–≤–µ—Ä—ã
- **web-1** (192.168.20.21) - Nginx –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–π —Å–µ—Ç–∏ –∑–æ–Ω—ã A
- **web-2** (192.168.30.27) - Nginx –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–π —Å–µ—Ç–∏ –∑–æ–Ω—ã B
- **Load Balancer**: Application Load Balancer –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- **Zabbix Server** (158.160.127.151) - –≤ –ø—É–±–ª–∏—á–Ω–æ–π —Å–µ—Ç–∏
- **Zabbix Agents** - –Ω–∞ web-1 –∏ web-2
- –î–∞—à–±–æ—Ä–¥—ã —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ CPU, RAM, –¥–∏—Å–∫–∏, —Å–µ—Ç—å, HTTP

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Elasticsearch** (192.168.20.9) - –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–π —Å–µ—Ç–∏
- **Kibana** (158.160.124.158) - –≤ –ø—É–±–ª–∏—á–Ω–æ–π —Å–µ—Ç–∏

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Snapshot Schedule** –¥–ª—è –≤—Å–µ—Ö –í–ú
- –ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ 2:00 AM UTC
- –•—Ä–∞–Ω–µ–Ω–∏–µ 7 —Å–Ω–∏–º–∫–æ–≤ (1 –Ω–µ–¥–µ–ª—è)

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Terraform >= 1.0
- Yandex Cloud CLI
- SSH –∫–ª—é—á –¥–ª—è –¥–æ—Å—Ç—É–ø–∞

### –®–∞–≥–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

```bash
cd terraform/
terraform init
terraform apply -auto-approve
terraform output
```

## –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º

| –°–µ—Ä–≤–∏—Å | URL | –õ–æ–≥–∏–Ω | –ü–∞—Ä–æ–ª—å |
|--------|-----|-------|--------|
| Zabbix | http://158.160.127.151 | admin | zabbix |
| Kibana | http://158.160.124.158:5601 | - | - |
| –í–µ–± | http://<alb_ip> | - | - |

### Bastion Host

SSH –¥–æ—Å—Ç—É–ø:
```bash
ssh -i ~/.ssh/id_rsa ubuntu@158.160.55.35
```

SSH —á–µ—Ä–µ–∑ –±–∞—Å—Ç–∏–æ–Ω –∫ web-1:
```bash
ssh -i ~/.ssh/id_rsa -o "ProxyCommand=ssh -i ~/.ssh/id_rsa -W %h:%p ubuntu@158.160.55.35" ubuntu@192.168.20.21
```

## –§–∞–π–ª—ã Terraform

- `main.tf` - –æ—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `instances.tf` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –í–ú
- `alb.tf` - Load Balancer
- `snapshots.tf` - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è
- `provisioning.tf` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Ansible ‚Üê –ö–ª—é—á–µ–≤–æ–π —Ñ–∞–π–ª
- `variables.tf` - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è - –í–´–ü–û–õ–ù–ï–ù–û ‚úÖ

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
‚úÖ Terraform –¥–ª—è —Ä–∞–∑–≤—ë—Ä—Ç–∫–∏
‚úÖ VPC Network —Å –ø—É–±–ª–∏—á–Ω—ã–º–∏ –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–º–∏ —Å–µ—Ç—è–º–∏
‚úÖ Bastion Host
‚úÖ NAT Gateway

### –í–µ–±-—Å–∞–π—Ç
‚úÖ –î–≤–µ –í–ú –≤ —Ä–∞–∑–Ω—ã—Ö –∑–æ–Ω–∞—Ö (web-1, web-2)
‚úÖ Nginx —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
‚úÖ –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ —Å–µ—Ç–∏
‚úÖ –î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ Bastion SSH
‚úÖ Load Balancer

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
‚úÖ Zabbix Server
‚úÖ Zabbix Agents
‚úÖ –î–∞—à–±–æ—Ä–¥—ã

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚úÖ Elasticsearch
‚úÖ Kibana

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
‚úÖ Snapshot Schedule

### –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤ ‚úÖ –ù–û–í–û–ï
‚úÖ Terraform —Å–æ–∑–¥–∞–µ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É
‚úÖ Ansible –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã (5 —Ñ–∞–∑)
‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚úÖ –í—Å—ë –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–æ

## –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ Terraform

```
bastion_public_ip = "158.160.55.35"
elasticsearch_private_ip = "192.168.20.9"
kibana_public_ip = "158.160.124.158"
web-1_private_ip = "192.168.20.21"
web-2_private_ip = "192.168.30.27"
zabbix_public_ip = "158.160.127.151"
```

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- Filebeat –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑-–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ç—è–º
- ALB –∏–º–µ–µ—Ç –±–∞–≥ –≤ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–µ Terraform (endpoint –æ—Å—Ç–∞–µ—Ç—Å—è null, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç)

## –°—Ç–æ–∏–º–æ—Å—Ç—å

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
- 2 —è–¥—Ä–∞, 20% Intel Ice Lake
- 2-4 –ì–± –ø–∞–º—è—Ç–∏
- 10 –ì–± SSD
- –ü—Ä–µ—Ä—ã–≤–∞–µ–º—ã–µ –í–ú

## –ê–≤—Ç–æ—Ä

–ù–∏–∫–æ–ª–∞–π –ó–∞—Ä—É–±–æ–≤
nvzarubov@gmail.com
